{
  "finished_at": "2026-01-20T04:53:12.347269Z",
  "meta": {
    "attempt": 1,
    "request_fingerprint": "b6ba79b069aebd76",
    "tag": "graphql_core_item2061"
  },
  "request": {
    "body": {
      "query": "query GetIssueOrPRCore($owner: String!, $name: String!, $number: Int!) {\n  repository(owner: $owner, name: $name) {\n    issueOrPullRequest(number: $number) {\n      __typename\n      ... on Issue {\n        id\n        databaseId\n        number\n        url\n        title\n        body\n        state\n        locked\n        author {\n          __typename\n          login\n          url\n          avatarUrl\n          ... on User { id databaseId }\n          ... on Organization { id databaseId }\n          ... on Bot { id databaseId }\n          ... on Mannequin { id databaseId }\n        }\n        authorAssociation\n        createdAt\n        updatedAt\n        closedAt\n        labels(first: 100) { nodes { name color description } }\n        milestone { title description dueOn state number }\n        assignees(first: 100) { nodes { login id databaseId url avatarUrl __typename } }\n        comments { totalCount }\n      }\n      ... on PullRequest {\n        id\n        databaseId\n        number\n        url\n        title\n        body\n        state\n        isDraft\n        locked\n        author {\n          __typename\n          login\n          url\n          avatarUrl\n          ... on User { id databaseId }\n          ... on Organization { id databaseId }\n          ... on Bot { id databaseId }\n          ... on Mannequin { id databaseId }\n        }\n        authorAssociation\n        createdAt\n        updatedAt\n        closedAt\n        mergedAt\n        mergedBy {\n          __typename\n          login\n          url\n          avatarUrl\n          ... on User { id databaseId }\n          ... on Organization { id databaseId }\n          ... on Bot { id databaseId }\n          ... on Mannequin { id databaseId }\n        }\n        mergeCommit { oid url }\n        baseRefName\n        headRefName\n        headRefOid\n        additions\n        deletions\n        changedFiles\n        labels(first: 100) { nodes { name color description } }\n        milestone { title description dueOn state number }\n        assignees(first: 100) { nodes { login id databaseId url avatarUrl __typename } }\n        comments { totalCount }\n        reviews { totalCount }\n        files { totalCount }\n      }\n    }\n  }\n}",
      "variables": {
        "name": "openai-agents-python",
        "number": 2061,
        "owner": "openai"
      }
    },
    "headers": {
      "Accept": "application/vnd.github+json",
      "Content-Type": "application/json",
      "X-GitHub-Api-Version": "2022-11-28"
    },
    "method": "POST",
    "url": "https://api.github.com/graphql"
  },
  "response": {
    "headers": {
      "access-control-allow-origin": "*",
      "access-control-expose-headers": "ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, X-GitHub-SSO, X-GitHub-Request-Id, Deprecation, Sunset",
      "content-length": "3987",
      "content-security-policy": "default-src 'none'",
      "content-type": "application/json; charset=utf-8",
      "date": "Tue, 20 Jan 2026 04:53:12 GMT",
      "github-authentication-token-expiration": "2026-02-19 04:41:20 UTC",
      "referrer-policy": "origin-when-cross-origin, strict-origin-when-cross-origin",
      "server": "github.com",
      "strict-transport-security": "max-age=31536000; includeSubdomains; preload",
      "vary": "Accept-Encoding, Accept, X-Requested-With",
      "x-accepted-oauth-scopes": "repo",
      "x-content-type-options": "nosniff",
      "x-frame-options": "deny",
      "x-github-media-type": "github.v4; format=json",
      "x-github-request-id": "DA7E:F2819:169BE1A:1FA54CA:696F0A38",
      "x-oauth-scopes": "repo",
      "x-ratelimit-limit": "5000",
      "x-ratelimit-remaining": "4977",
      "x-ratelimit-reset": "1768888376",
      "x-ratelimit-resource": "graphql",
      "x-ratelimit-used": "23",
      "x-xss-protection": "0"
    },
    "json": {
      "data": {
        "repository": {
          "issueOrPullRequest": {
            "__typename": "Issue",
            "assignees": {
              "nodes": []
            },
            "author": {
              "__typename": "User",
              "avatarUrl": "https://avatars.githubusercontent.com/u/136383052?u=c3abd7a04ff57b02e274a04432ea9f184de3d7d8&v=4",
              "databaseId": 136383052,
              "id": "U_kgDOCCEKTA",
              "login": "habema",
              "url": "https://github.com/habema"
            },
            "authorAssociation": "CONTRIBUTOR",
            "body": "### Problem\nWhen a tool call contains invalid JSON arguments (e.g., missing closing brace), the session stores the invalid JSON string. This breaks the session with Anthropic models, as LiteLLM attempts to parse the arguments from JSON strings into JSONs (as per Anthropic API specs), and fails rightfully.\n\n### Root Cause\n1. Invalid JSON gets stored in session history in `tool_call.arguments`\n2. On reload, `chatcmpl_converter.py:527` passes the invalid JSON string directly to litellm\n3. litellm converts OpenAI format (JSON string) â†’ Anthropic format (dict) by calling `json.loads()`\n4. JSON parsing fails before tool invocation: `\"Expecting ',' delimiter: line 1 column 30\"`\n\n#### Note: \nCustom `FunctionTool` implementations can bypass the JSON validation that only happens in `_on_invoke_tool_impl` within `function_tool`, so this could cause unexpected behavior in those tools.\n\n\n### Repro Script:\n```py\n@function_tool\ndef get_server_time(format: str = \"%Y-%m-%d %H:%M:%S\") -> str:\n    \"\"\"\n    Returns the current server time, optionally in a specified format.\n    \"\"\"\n    return datetime.now().strftime(format)\n\n\nasync def main():\n    # Mimic session memory functionality.\n    input_list = [\n        {\"content\": \"What is the current server time?\", \"role\": \"user\"},\n        {\n            \"arguments\": '{\"format\":\"%Y-%m-%d %H:%M:%S\"',  # Invalid JSON on purpose\n            \"call_id\": \"call_9YhapDWwiCFcoGZilhyUo8ti\",\n            \"name\": \"get_server_time\",\n            \"type\": \"function_call\",\n            \"id\": \"fc_0e0babe7f7b9bf95006910adb438588193a96b6a1d917c77e7\",\n            \"status\": \"completed\",\n        },\n        {\n            \"call_id\": \"call_9YhapDWwiCFcoGZilhyUo8ti\",\n            \"output\": \"An error occurred while running the tool. Please try again. Error: Not implemented\",\n            \"type\": \"function_call_output\",\n        },\n        {\n            \"id\": \"msg_0e0babe7f7b9bf95006910adb5a4cc8193b5e3a1a171b76db1\",\n            \"content\": [\n                {\n                    \"annotations\": [],\n                    \"text\": \"I encountered an error trying to get the time now. Would you like me to try again?\",\n                    \"type\": \"output_text\",\n                    \"logprobs\": [],\n                }\n            ],\n            \"role\": \"assistant\",\n            \"status\": \"completed\",\n            \"type\": \"message\",\n        },\n    ]\n\n    agent = Agent(\n        name=\"Assistant\",\n        instructions=\"Reply very concisely.\",\n        model=\"litellm/anthropic/claude-haiku-4-5-20251001\",\n        tools=[get_server_time],\n    )\n\n    print(\"User: How about now?\")\n    result = await Runner.run(\n        agent,\n        input_list + [{\"content\": \"How about now?\", \"role\": \"user\"}],\n    )\n\n    print(result.final_output)\n```\n",
            "closedAt": "2026-01-20T01:46:31Z",
            "comments": {
              "totalCount": 0
            },
            "createdAt": "2025-11-09T17:23:41Z",
            "databaseId": 3605248506,
            "id": "I_kwDOOGidp87W47n6",
            "labels": {
              "nodes": [
                {
                  "color": "d73a4a",
                  "description": "Something isn't working",
                  "name": "bug"
                },
                {
                  "color": "77cf69",
                  "description": "",
                  "name": "feature:chat-completions"
                },
                {
                  "color": "a95c3a",
                  "description": "",
                  "name": "feature:lite-llm"
                }
              ]
            },
            "locked": false,
            "milestone": {
              "description": "",
              "dueOn": null,
              "number": 1,
              "state": "CLOSED",
              "title": "0.6.x"
            },
            "number": 2061,
            "state": "CLOSED",
            "title": "Invalid JSON in tool call arguments breaks session with Anthropic models",
            "updatedAt": "2026-01-20T01:55:22Z",
            "url": "https://github.com/openai/openai-agents-python/issues/2061"
          }
        }
      }
    },
    "status": 200
  },
  "started_at": "2026-01-20T04:53:11.892076Z"
}
